"""
CORS middleware configuration for Scorpius API
Enhanced for frontend integration
"""

from fastapi.middleware.cors import CORSMiddleware
from typing import List
import os

class CORSConfig:
    """CORS configuration for frontend integration"""
    
    @staticmethod
    def get_allowed_origins() -> List[str]:
        """Get allowed origins from environment or defaults"""
        origins_env = os.getenv("CORS_ORIGINS", "")
        
        if origins_env:
            return [origin.strip() for origin in origins_env.split(",")]
        
        # Default development origins
        return [
            "http://localhost:3000",  # React dev server
            "http://localhost:5173",  # Vite dev server
            "http://localhost:4173",  # Vite preview
            "http://127.0.0.1:3000",
            "http://127.0.0.1:5173",
            "http://127.0.0.1:4173",
        ]
    
    @staticmethod
    def get_production_origins() -> List[str]:
        """Get production origins"""
        return [
            "https://*.netlify.app",   # Netlify deployments
            "https://*.vercel.app",    # Vercel deployments
            "https://*.herokuapp.com", # Heroku deployments
            "https://*.azurewebsites.net", # Azure deployments
        ]
    
    @staticmethod
    def setup_cors(app) -> None:
        """Setup CORS middleware on FastAPI app"""
        
        origins = CORSConfig.get_allowed_origins()
        
        # Add production origins if in production
        if os.getenv("ENVIRONMENT") == "production":
            origins.extend(CORSConfig.get_production_origins())
        
        app.add_middleware(
            CORSMiddleware,
            allow_origins=origins,
            allow_credentials=True,
            allow_methods=["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"],
            allow_headers=["*"],
            expose_headers=["*"]
        )
