#!/bin/bash
# Mythril entrypoint script

set -e

INPUT_DIR="/workspace/input"
OUTPUT_DIR="/workspace/output"
CONTRACT_FILE="${INPUT_DIR}/contract.sol"

if [ ! -f "$CONTRACT_FILE" ]; then
    echo "Error: No contract.sol found in ${INPUT_DIR}" >&2
    exit 1
fi

echo "Running Mythril analysis on ${CONTRACT_FILE}..."

OUTPUT_FILE="${OUTPUT_DIR}/results.json"

# Run Mythril with JSON output
myth analyze "$CONTRACT_FILE" \
    --solv 0.8.19 \
    --output json \
    --max-depth 12 \
    --execution-timeout 300 \
    > "$OUTPUT_FILE" 2>&1 || {
        # If Mythril fails, create error results file
        echo '{"issues": [], "error": "Analysis failed or timed out"}' > "$OUTPUT_FILE"
    }

echo "Mythril analysis completed. Results saved to ${OUTPUT_FILE}"
