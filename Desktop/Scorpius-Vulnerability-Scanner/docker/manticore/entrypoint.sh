#!/bin/bash
# Manticore entrypoint script

set -e

INPUT_DIR="/workspace/input"
OUTPUT_DIR="/workspace/output"
CONTRACT_FILE="${INPUT_DIR}/contract.sol"

if [ ! -f "$CONTRACT_FILE" ]; then
    echo "Error: No contract.sol found in ${INPUT_DIR}" >&2
    exit 1
fi

echo "Running Manticore symbolic execution on ${CONTRACT_FILE}..."

OUTPUT_FILE="${OUTPUT_DIR}/results.json"

# Run Manticore using our custom runner
python3 /app/manticore_runner.py "$CONTRACT_FILE" "$OUTPUT_FILE" || {
    # If Manticore fails, create error results file
    echo '{"vulnerabilities": [], "error": "Symbolic execution failed"}' > "$OUTPUT_FILE"
}

echo "Manticore analysis completed. Results saved to ${OUTPUT_FILE}"
