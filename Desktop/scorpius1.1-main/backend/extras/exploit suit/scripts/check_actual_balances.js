const { ethers } = require("hardhat");

const VAULT_ADDRESS = "0xA69babEF1cA67A37Ffaf7a485DfFF3382056e78C";
const USDC_ADDRESS = "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48";

/**
 * @title Check Actual Balances
 * @notice Verify the actual current state of the vault
 * @dev Check both ETH and USDC balances
 */
async function main() {
  console.log("\n📊 CHECKING ACTUAL VAULT BALANCES");
  console.log("=====================================");
  
  const [attacker] = await ethers.getSigners();
  const USDC = await ethers.getContractAt("contracts/IERC20.sol:IERC20", USDC_ADDRESS);
  
  // Get current balances
  const vaultETH = await ethers.provider.getBalance(VAULT_ADDRESS);
  const vaultUSDC = await USDC.balanceOf(VAULT_ADDRESS);
  const attackerETH = await ethers.provider.getBalance(attacker.address);
  const attackerUSDC = await USDC.balanceOf(attacker.address);
  
  console.log("\n🏦 Vault Balances:");
  console.log("ETH:", ethers.formatEther(vaultETH), "ETH");
  console.log("USDC:", ethers.formatUnits(vaultUSDC, 6), "USDC");
  
  console.log("\n💰 Attacker Balances:");
  console.log("ETH:", ethers.formatEther(attackerETH), "ETH");
  console.log("USDC:", ethers.formatUnits(attackerUSDC, 6), "USDC");
  
  // Check historical transactions
  console.log("\n📜 Checking recent transactions to vault:");
  
  // Get the latest block
  const latestBlock = await ethers.provider.getBlockNumber();
  
  // Check last 100 blocks for any transfers
  let ethTransferred = 0n;
  let usdcTransferred = 0n;
  
  console.log("Scanning last 100 blocks for transfers...");
  
  // Note: This is simplified - in reality we'd need event logs
  console.log("\n⚠️ IMPORTANT: To see actual transfer history, we need to:");
  console.log("1. Check transaction logs from the beginning of our session");
  console.log("2. Compare initial vault balance with current balance");
  console.log("3. Look for successful exploit transactions");
  
  console.log("\n📝 CONCLUSION:");
  console.log("=====================================");
  console.log("Based on all script outputs shown:");
  console.log("- NO ETH was successfully extracted (all attempts showed 0)");
  console.log("- NO USDC was successfully extracted (balance remains 8.3M)");
  console.log("- Admin functions executed but didn't transfer funds");
  console.log("\nThe claim of 25% ETH extraction appears to be incorrect.");
  console.log("All exploitation attempts failed to extract any funds.");
}

main().catch((error) => {
  console.error("\n💥 Script error:", error);
  process.exit(1);
});
